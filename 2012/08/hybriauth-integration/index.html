<!doctype html><html lang=ru dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HybridAuth — интеграция сайта с социальными сетями" | Ayrat Belyaev</title><meta name=keywords content="github,hybridauth,social-login,twitter,yandex,habr,php"><meta name=description content="Это копия моей оригинальной статьи, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.
 Введение На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:
 Авторизация пользователей в случае закрытия Loginza или отказа от нее &mdash; в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email; Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар."><meta name=author content="Ayrat Belyaev"><link rel=canonical href=https://aybe.org/2012/08/hybriauth-integration/><link crossorigin=anonymous href=/assets/css/stylesheet.min.6133e054c3af07b39ba41b5d09b207d60fd550c8a1ca6cb5f4e8423fcbb9ef96.css integrity="sha256-YTPgVMOvB7ObpBtdCbIH1g/VUMihymy19OhCP8u575Y=" rel="preload stylesheet" as=style><link rel=preload href=/img/avatar-35.jpg as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://aybe.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aybe.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://aybe.org/favicon-32x32.png><link rel=apple-touch-icon href=https://aybe.org/apple-touch-icon.png><link rel=mask-icon href=https://aybe.org/favicon-32x32.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><script defer crossorigin=anonymous src=/assets/js/comments.min.70dce0ef190a617cbc8c42892eb4d253d8f1f6e9ecef13bb9aedba8a84cb5278.js integrity="sha256-cNzg7xkKYXy8jEKJLrTSU9jx9uns7xO7mu26ioTLUng="></script><script src=https://www.google.com/recaptcha/api.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-MFD8PM59LW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-MFD8PM59LW',{anonymize_ip:!1})}</script><meta property="og:title" content="HybridAuth — интеграция сайта с социальными сетями&#34;"><meta property="og:description" content="Это копия моей оригинальной статьи, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.
 Введение На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:
 Авторизация пользователей в случае закрытия Loginza или отказа от нее &mdash; в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email; Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар."><meta property="og:type" content="article"><meta property="og:url" content="https://aybe.org/2012/08/hybriauth-integration/"><meta property="og:image" content="https://aybe.org/img/posts/hybridauth_0.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2012-08-07T14:25:04+03:00"><meta property="article:modified_time" content="2021-07-26T12:34:37+03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aybe.org/img/posts/hybridauth_0.png"><meta name=twitter:title content="HybridAuth — интеграция сайта с социальными сетями&#34;"><meta name=twitter:description content="Это копия моей оригинальной статьи, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.
 Введение На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:
 Авторизация пользователей в случае закрытия Loginza или отказа от нее &mdash; в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email; Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар."><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Записи",
      "item": "https://aybe.org/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Сайты",
      "item": "https://aybe.org/posts/site/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "HybridAuth — интеграция сайта с социальными сетями\"",
      "item": "https://aybe.org/2012/08/hybriauth-integration/"
    }
  ]
}
</script><script type=application/ld+json>
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HybridAuth — интеграция сайта с социальными сетями\"",
  "name": "HybridAuth — интеграция сайта с социальными сетями\u0022",
  "description": "Это копия моей оригинальной статьи, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.\n Введение На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:\n Авторизация пользователей в случае закрытия Loginza или отказа от нее \u0026mdash; в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email; Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар.",
  "keywords": [
    "github", "hybridauth", "social-login", "twitter", "yandex", "habr", "php"
  ],
  "articleBody": " Это копия моей оригинальной статьи, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.\n Введение На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:\n Авторизация пользователей в случае закрытия Loginza или отказа от нее — в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email; Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар. С Логинзой получить эти данные не представляется возможным, сервис сам решает какие данные запрашивать и какие отдавать; С момента продажи Яндексу Логинза начала умирать: на запросы пользователей никто не отвечает, сервис не развивается, а находится в том виде, в котором был 1-2 года назад.\nВстал вопрос замены и использовать альтернативные сервисы желания уже не возникало — никто не представлял возможности «общаться» с соц. сетью напрямую, а расширенные поля профиля обычно включались в платные услуги. Хотелось автономного решения с возможностью гибкой настройки запрашиваемых полей и в итоге я остановился на php библиотеке HybridAuth.  HybridAuth HybridAuth — библиотека с открытым исходным кодом, которая позволяет использовать авторизацию с использованием OAuth1, OAuth2 и OpenID. В составе библиотеки уже идут настройки для большинства популярных соц. сетей, таких как Google, Facebook, Twitter, и есть даже ВКонтакте. Текущая стабильная версия 2.0.11, версия в разработке 2.1.0 — ссылки на github есть в конце статьи. Распространяется по лицензиям MIT и GPL, подробнее об этом можно прочитать здесь.\nВ состав библиотеки включены примеры использования и набор наиболее популярных сервисов авторизации. Рассмотрим пример авторизации через Twitter, для этого возьмем последнюю стабильную версию и установим ее на локальном сервере. Все примеры находятся в каталоге examples, настройки сервисов в hybridauth/config.php, там же находится install.php, который поможет нам создать файл настроек автоматически, откроем его:\nДля начала нам необходимо указать Endpoint URL — полный путь к корневому каталогу плагина, он используется некоторыми сервисами для возрата на ваш сайт. Далее идут настройки всех сервисов авторизации, а так же инструкции по получению ID и Secret:\nДля нашего примера создадим приложение в Twitter. После этого внесем их в настройки нашей библиотеки и сохраним. Теперь рассмотрим пример авторизации, создадим в корне сайта файл test.php:\nphp session_start(); $config = dirname(__FILE__) . '/hybridauth/config.php'; require_once( \"hybridauth/Hybrid/Auth.php\" ); if( isset( $_GET[\"login\"] ) ) { try { $hybridauth = new Hybrid_Auth( $config ); $adapter = $hybridauth-authenticate( \"twitter\" ); $user_profile = $adapter-getUserProfile(); } catch( Exception $e ) { die( \"got an error! \" . $e-getMessage() ); } } if( ! isset( $user_profile ) ) { ?Нажмите Войти для авторизации.\nВойти } else { ?  twitter данные Привет displayName; ? Hybridauth access tokens for twitter: getAccessToken() ); ?  } ?  Рассмотрим, что он делает:\n Проверяет GET параметр login, если его нет, то открывает страницу с предложением авторизации; При переходе по ссылке mysite.ru/twitter.php?login=1 мы запускаем процесс авторизации. Создается экземпляр класса Hybrid_Auth и с помощью метода authenticate передается название сервиса, через который мы хотим авторизоваться; Открывается Facebook с предложением авторизации, если пользователь дает доступ, то метод getUserProfile вернет нам данные его профиля, иначе мы получим ошибку.\nВсе очень просто! Теперь, посмотрим какие именно данные получает getUserProfile в случае с Twitter. Для этого откроем каталог hybridauth/Hybrid/Providers, где в виде файлов хранятся настройки сервисов авторизации, нам нужен Twitter.php. Находим метод getUserProfile и видим получаемые данные:  $this-user-profile-identifier = (property_exists($response,'id'))?$response-id:\"\"; $this-user-profile-displayName = (property_exists($response,'screen_name'))?$response-screen_name:\"\"; $this-user-profile-description = (property_exists($response,'description'))?$response-description:\"\"; $this-user-profile-firstName = (property_exists($response,'name'))?$response-name:\"\"; $this-user-profile-photoURL = (property_exists($response,'profile_image_url'))?$response-profile_image_url:\"\"; $this-user-profile-profileURL = (property_exists($response,'screen_name'))?(\"http://twitter.com/\".$response-screen_name):\"\"; $this-user-profile-webSiteURL = (property_exists($response,'url'))?$response-url:\"\"; $this-user-profile-region = (property_exists($response,'location'))?$response-location:\"\"; Можно поменять любые данные или добавить свои, так же в этом файле реализованы методы получения контактов профиля и изменения статуса. То есть при необходимости для любой социальной сети можно не только изменить набор необходимых данных, но и дописать свой функционал на основе их API.\nЯндекс В качестве примера добавления нового сервиса авторизации, попробуем добавить Яндекс, для этого создадим hybridauth/Hybrid/Providers/Yandex.php. Яндекс использует OAuth2 для авторизации, поэтому наш класс будет наследовать его:\nclass Hybrid_Providers_Yandex extends Hybrid_Provider_Model_OAuth2 Для OAuth1 нужно использовать Hybrid_Provider_Model_OAuth1, а для OpenID — Hybrid_Provider_Model_OpenID. Теперь нам необходимо разобраться какие данные нужны Яндексу для авторизации пользователя и доступу к данным его профиля. Сначала создадим приложение Яндекс API, для получения ID и Secret полей — заходим сюда и регистрируем новое приложение. Для получения данных профиля будем использовать API Логин.Яндекс, где отметим поля почтового ящика и ФИО пользователя.\nПример заполнения данных\nУ нас есть необходимые ключи, осталось внести их в настройки HybridAuth, открываем hybridauth/config.php и в конец добавляем:\n\"Yandex\" = array ( \"enabled\" = true, \"keys\" = array ( \"id\" = \"Id приложения\", \"secret\" = \"Пароль приложения\" ) ), Далее читаем документацию Яндекса и видим, что для авторизации нам необходимо обращаться к [](https://oauth.yandex.ru/authorize)oauth.yandex.ru/authorize, а для получения токена к [](https://oauth.yandex.ru/token)oauth.yandex.ru/token. Осталось узнать адрес API Логин.Яндекс — для этого открываем документацию API и находим Вход через Яндекс, а там OAuth + Яндекс.Логин. Тут находим, что для получения информации о пользователе нужно обращаться к [](https://login.yandex.ru/info)login.yandex.ru/info. Отлично, все необходимое у нас есть, возвращаемся к Yandex.php, в функции initialize указываем ссылки на API:\n$this-api-api_base_url = \"https://login.yandex.ru/info\"; $this-api-authorize_url = \"https://oauth.yandex.ru/authorize\"; $this-api-token_url = \"https://oauth.yandex.ru/token\"; Так же укажем, что полученный токен необходимо передавать параметром oauth_token:\n$this-api-sign_token_name = \"oauth_token\"; Теперь в функции getProfiles напишем разбор данных, для начала сформируем запрос на получения профиля:\n$response = $this-api-api( \"?format=json\" ); Сейчас мы имеем объект $response, который содержит в себе все полученные данные, сохраним их по аналогии с Twitter.php:\n$this-user-profile-identifier = (property_exists($response,'id'))?$response-id:\"\"; $this-user-profile-firstName = (property_exists($response,'real_name'))?$response-real_name:\"\"; $this-user-profile-displayName = (property_exists($response,'display_name'))?$response-display_name:\"\"; $this-user-profile-photoURL = 'http://upics.yandex.net/'. $this-user-profile-identifier .'/normal'; $this-user-profile-gender = (property_exists($response,'sex'))?$response-sex:\"\"; $this-user-profile-email = (property_exists($response,'default_email'))?$response-default_email:\"\"; $this-user-profile-emailVerified = (property_exists($response,'default_email'))?$response-default_email:\"\"; В итоге мы получили вот такой файл:\nYandex.php php class Hybrid_Providers_Yandex extends Hybrid_Provider_Model_OAuth2 { function initialize() { parent::initialize(); $this-api-api_base_url = \"https://login.yandex.ru/info\"; $this-api-authorize_url = \"https://oauth.yandex.ru/authorize\"; $this-api-token_url = \"https://oauth.yandex.ru/token\"; $this-api-sign_token_name = \"oauth_token\"; } function getUserProfile() { $response = $this-api-api( \"?format=json\" ); if ( !isset( $response-id ) ) { throw new Exception( \"User profile request failed! {$this-providerId}returned an invalide response.\", 6 ); } $this-user-profile-identifier = (property_exists($response,'id'))?$response-id:\"\"; $this-user-profile-firstName = (property_exists($response,'real_name'))?$response-real_name:\"\"; $this-user-profile-displayName = (property_exists($response,'display_name'))?$response-display_name:\"\"; $this-user-profile-photoURL = 'http://upics.yandex.net/'. $this-user-profile-identifier .'/normal'; $this-user-profile-gender = (property_exists($response,'sex'))?$response-sex:\"\"; $this-user-profile-email = (property_exists($response,'default_email'))?$response-default_email:\"\"; $this-user-profile-emailVerified = (property_exists($response,'default_email'))?$response-default_email:\"\"; return $this-user-profile; } } ?\nИзменим наш пример с Twitter на Яндекс:\n$adapter = $hybridauth-authenticate( \"yandex\" ); Пробуем авторизоваться:\nИ в итоге получаем:\nВот и все, авторизация через Яндекс прошла успешно. Можно заняться подключением остальных сервисов, которые нам необходимы.\nУдобное подключение, простое добавление новых сервисов и открытый исходный код — все то, чего не хватало при работе со сторонними сервисами. Так же, для упрощения интеграции, библиотека имеет плагины к популярным фреймворкам и CMS, таким как Yii, Symfony2, Wordpress, Drupal и другие.\nПо поводу ошибок и неточностей, а так же с дополнениями просьба обращаться в личку.\nСсылки по теме:\n Страница библиотеки 2.x Страница загрузки библиотеки и плагинов 2.x Страница проекта на GitHub Мой форк проекта на GitHub Онлайн-демо авторизации  upd: выложил авторизацию для Яндекса и Mail.ru, Одноклассники получились с костылем для совместимости с PHP  5.3.0.\n",
  "wordCount" : "1132",
  "inLanguage": "ru",
  "image":"https://aybe.org/img/posts/hybridauth_0.png","datePublished": "2012-08-07T14:25:04+03:00",
  "dateModified": "2021-07-26T12:34:37+03:00",
  "author":{
    "@type": "Person",
    "name": "Ayrat Belyaev"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://aybe.org/2012/08/hybriauth-integration/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ayrat Belyaev",
    "logo": {
      "@type": "ImageObject",
      "url": "https://aybe.org/favicon.ico"
    }
  }
}
</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://aybe.org/ accesskey=h title="Ayrat Belyaev (Alt + H)"><img src=/img/avatar-35.jpg alt=logo aria-label=logo height=35>Ayrat Belyaev</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://aybe.org/search title=поиск><span>поиск</span></a></li><li><a href=https://aybe.org/archives title=архив><span>архив</span></a></li><li><a href=https://aybe.org/tags title=теги><span>теги</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aybe.org/>Главная</a>&nbsp;»&nbsp;<a href=https://aybe.org/posts/>Записи</a>&nbsp;»&nbsp;<a href=https://aybe.org/posts/site/>Сайты</a></div><h1 class=post-title>HybridAuth — интеграция сайта с социальными сетями"</h1><div class=post-meta>August 7, 2012&nbsp;·&nbsp;6 мин&nbsp;·&nbsp;Ayrat Belyaev</div></header><figure class=entry-cover><img loading=lazy src=https://aybe.org/img/posts/hybridauth_0.png alt></figure><div class=post-content><blockquote><p>Это копия моей <a href=https://habr.com/ru/post/149187/>оригинальной статьи</a>, опубликованной на Хабре в 2012 году. Опубликована как есть, без изменений текста, поправлены только ссылки.</p></blockquote><h4 id=введение>Введение<a hidden class=anchor aria-hidden=true href=#введение>#</a></h4><p>На своем сайте на php для авторизации пользователей я в последнее время пользовался сервисом Loginza. Все было очень круто и удобно, но в голове начала зарождаться идея отказа от этого замечательного сервиса и вот почему:</p><ol><li>Авторизация пользователей в случае закрытия Loginza или отказа от нее &mdash; в этом случае мы потеряем пользователей, в привязанных профилях которых не указан email;</li><li>Дополнительная информация, например, ВКонтакте умеет отдавать фото пользователя в нескольких видах, в том числе квадратный аватар. С Логинзой получить эти данные не представляется возможным, сервис сам решает какие данные запрашивать и какие отдавать;</li><li>С момента продажи Яндексу Логинза начала умирать: на запросы пользователей никто не отвечает, сервис не развивается, а находится в том виде, в котором был 1-2 года назад.<br>Встал вопрос замены и использовать альтернативные сервисы желания уже не возникало &mdash; никто не представлял возможности «общаться» с соц. сетью напрямую, а расширенные поля профиля обычно включались в платные услуги. Хотелось автономного решения с возможностью гибкой настройки запрашиваемых полей и в итоге я остановился на php библиотеке HybridAuth.</li></ol><h4 id=hybridauth>HybridAuth<a hidden class=anchor aria-hidden=true href=#hybridauth>#</a></h4><p>HybridAuth &mdash; библиотека с открытым исходным кодом, которая позволяет использовать авторизацию с использованием OAuth1, OAuth2 и OpenID. В составе библиотеки уже идут настройки для большинства популярных соц. сетей, таких как Google, Facebook, Twitter, и есть даже ВКонтакте. Текущая стабильная версия 2.0.11, версия в разработке 2.1.0 &mdash; ссылки на github есть в конце статьи. Распространяется по лицензиям MIT и GPL, подробнее об этом можно прочитать <a href=https://hybridauth.github.io/hybridauth/licenses.html>здесь</a>.</p><p>В состав библиотеки включены примеры использования и набор наиболее популярных сервисов авторизации. Рассмотрим пример авторизации через Twitter, для этого возьмем последнюю стабильную версию и установим ее на локальном сервере. Все примеры находятся в каталоге <code>examples</code>, настройки сервисов в <code>hybridauth/config.php</code>, там же находится <code>install.php</code>, который поможет нам создать файл настроек автоматически, откроем его:</p><p><img loading=lazy src=/img/posts/hybridauth_1.png alt></p><p>Для начала нам необходимо указать Endpoint URL &mdash; полный путь к корневому каталогу плагина, он используется некоторыми сервисами для возрата на ваш сайт. Далее идут настройки всех сервисов авторизации, а так же инструкции по получению ID и Secret:</p><p><img loading=lazy src=/img/posts/hybridauth_2.png alt></p><p>Для нашего примера <a href=https://dev.twitter.com/apps>создадим</a> приложение в Twitter. После этого внесем их в настройки нашей библиотеки и сохраним. Теперь рассмотрим пример авторизации, создадим в корне сайта файл <code>test.php</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#a6e22e>session_start</span>();
$config <span style=color:#f92672>=</span> <span style=color:#a6e22e>dirname</span>(<span style=color:#66d9ef>__FILE__</span>) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/hybridauth/config.php&#39;</span>;
<span style=color:#66d9ef>require_once</span>( <span style=color:#e6db74>&#34;hybridauth/Hybrid/Auth.php&#34;</span> );
<span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>isset</span>( $_GET[<span style=color:#e6db74>&#34;login&#34;</span>] ) ) {
  <span style=color:#66d9ef>try</span>  {
    $hybridauth <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hybrid_Auth</span>( $config );
    $adapter <span style=color:#f92672>=</span> $hybridauth<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authenticate</span>( <span style=color:#e6db74>&#34;twitter&#34;</span> );
    $user_profile <span style=color:#f92672>=</span> $adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getUserProfile</span>();
  } <span style=color:#66d9ef>catch</span>( <span style=color:#a6e22e>Exception</span> $e )  {
    <span style=color:#66d9ef>die</span>( <span style=color:#e6db74>&#34;&lt;b&gt;got an error!&lt;/b&gt; &#34;</span> <span style=color:#f92672>.</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>() );
  }
}
<span style=color:#66d9ef>if</span>( <span style=color:#f92672>!</span> <span style=color:#a6e22e>isset</span>( $user_profile ) ) {
  <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>  &lt;p&gt;Нажмите Войти для авторизации.&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;h2&gt;&lt;a href =&#34;test.php?login=1&#34;&gt;Войти&lt;/a&gt;&lt;/h2&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;?php
</span><span style=color:#960050;background-color:#1e0010>} else {
</span><span style=color:#960050;background-color:#1e0010>  ?&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;legend&gt;twitter данные&lt;/legend&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;b&gt;Привет &lt;?php echo $user_profile-&gt;displayName; ?&gt;&lt;/b&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;hr /&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;b&gt;Hybridauth access tokens for twitter:&lt;/b&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;pre&gt;&lt;?php print_r( $adapter-&gt;getAccessToken() ); ?&gt;&lt;/pre&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;/fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>  &lt;?php
</span><span style=color:#960050;background-color:#1e0010>}
</span><span style=color:#960050;background-color:#1e0010>?&gt;
</span></code></pre></div><p>Рассмотрим, что он делает:</p><ol><li>Проверяет GET параметр login, если его нет, то открывает страницу с предложением авторизации;</li><li>При переходе по ссылке mysite.ru/twitter.php?login=1 мы запускаем процесс авторизации. Создается экземпляр класса Hybrid_Auth и с помощью метода authenticate передается название сервиса, через который мы хотим авторизоваться;</li><li>Открывается Facebook с предложением авторизации, если пользователь дает доступ, то метод getUserProfile вернет нам данные его профиля, иначе мы получим ошибку.<br>Все очень просто! Теперь, посмотрим какие именно данные получает <code>getUserProfile</code> в случае с Twitter. Для этого откроем каталог <code>hybridauth/Hybrid/Providers</code>, где в виде файлов хранятся настройки сервисов авторизации, нам нужен <code>Twitter.php</code>. Находим метод <code>getUserProfile</code> и видим получаемые данные:</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identifier</span>  <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;id&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>displayName</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;screen_name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>screen_name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>description</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;description&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>description</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>   <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>photoURL</span>    <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;profile_image_url&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile_image_url</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profileURL</span>  <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;screen_name&#39;</span>))<span style=color:#f92672>?</span>(<span style=color:#e6db74>&#34;http://twitter.com/&#34;</span><span style=color:#f92672>.</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>screen_name</span>)<span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>webSiteURL</span>  <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;url&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>url</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>region</span>      <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;location&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>location</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;</code></pre></div><p>Можно поменять любые данные или добавить свои, так же в этом файле реализованы методы получения контактов профиля и изменения статуса. То есть при необходимости для любой социальной сети можно не только изменить набор необходимых данных, но и дописать свой функционал на основе их API.</p><h4 id=яндекс>Яндекс<a hidden class=anchor aria-hidden=true href=#яндекс>#</a></h4><p>В качестве примера добавления нового сервиса авторизации, попробуем добавить Яндекс, для этого создадим <code>hybridauth/Hybrid/Providers/Yandex.php</code>. Яндекс использует OAuth2 для авторизации, поэтому наш класс будет наследовать его:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hybrid_Providers_Yandex</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Hybrid_Provider_Model_OAuth2</span></code></pre></div><p>Для OAuth1 нужно использовать <code>Hybrid_Provider_Model_OAuth1</code>, а для OpenID &mdash; <code>Hybrid_Provider_Model_OpenID</code>. Теперь нам необходимо разобраться какие данные нужны Яндексу для авторизации пользователя и доступу к данным его профиля. Сначала создадим приложение Яндекс API, для получения ID и Secret полей &mdash; заходим <a href=https://oauth.yandex.ru/client/my>сюда</a> и регистрируем новое приложение. Для получения данных профиля будем использовать API Логин.Яндекс, где отметим поля почтового ящика и ФИО пользователя.</p><p>Пример заполнения данных</p><p><img loading=lazy src=/img/posts/hybridauth_3.png alt></p><p>У нас есть необходимые ключи, осталось внести их в настройки HybridAuth, открываем <code>hybridauth/config.php</code> и в конец добавляем:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#e6db74>&#34;Yandex&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span> ( <span style=color:#e6db74>&#34;enabled&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;keys&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span> ( <span style=color:#e6db74>&#34;id&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Id приложения&#34;</span>, <span style=color:#e6db74>&#34;secret&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Пароль приложения&#34;</span> ) ),</code></pre></div><p>Далее читаем <a href=http://api.yandex.ru/oauth/doc/dg/reference/obtain-access-token.xml>документацию Яндекса</a> и видим, что для авторизации нам необходимо обращаться к <code>[](https://oauth.yandex.ru/authorize)oauth.yandex.ru/authorize</code>, а для получения токена к <code>[](https://oauth.yandex.ru/token)oauth.yandex.ru/token</code>. Осталось узнать адрес API Логин.Яндекс &mdash; для этого открываем документацию <a href=http://api.yandex.ru/>API</a> и находим Вход через Яндекс, а там <a href=http://api.yandex.ru/login/>OAuth + Яндекс.Логин</a>. Тут находим, что для получения информации о пользователе нужно обращаться к <code>[](https://login.yandex.ru/info)login.yandex.ru/info</code>. Отлично, все необходимое у нас есть, возвращаемся к Yandex.php, в функции initialize указываем ссылки на API:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api_base_url</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://login.yandex.ru/info&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authorize_url</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://oauth.yandex.ru/authorize&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_url</span>     <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://oauth.yandex.ru/token&#34;</span>;</code></pre></div><p>Так же укажем, что полученный токен необходимо передавать параметром <code>oauth_token</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_token_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;oauth_token&#34;</span>;</code></pre></div><p>Теперь в функции getProfiles напишем разбор данных, для начала сформируем запрос на получения профиля:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$response <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span>( <span style=color:#e6db74>&#34;?format=json&#34;</span> );</code></pre></div><p>Сейчас мы имеем объект $response, который содержит в себе все полученные данные, сохраним их по аналогии с Twitter.php:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identifier</span>    <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;id&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>     <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;real_name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>real_name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>displayName</span>   <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;display_name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>display_name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>photoURL</span>      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://upics.yandex.net/&#39;</span><span style=color:#f92672>.</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identifier</span> <span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/normal&#39;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>gender</span>        <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;sex&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sex</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>         <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;default_email&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>default_email</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>emailVerified</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;default_email&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>default_email</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;</code></pre></div><p>В итоге мы получили вот такой файл:</p><p><strong>Yandex.php</strong><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Hybrid_Providers_Yandex</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Hybrid_Provider_Model_OAuth2</span> {
  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>initialize</span>() {
    <span style=color:#66d9ef>parent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>initialize</span>();
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api_base_url</span>    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://login.yandex.ru/info&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authorize_url</span>   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://oauth.yandex.ru/authorize&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>token_url</span>       <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://oauth.yandex.ru/token&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sign_token_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;oauth_token&#34;</span>;
  }
  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getUserProfile</span>() {
    $response <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>api</span>( <span style=color:#e6db74>&#34;?format=json&#34;</span> );
    <span style=color:#66d9ef>if</span> ( <span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>( $response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span> ) ) {
      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>( <span style=color:#e6db74>&#34;User profile request failed! </span><span style=color:#e6db74>{</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>providerId</span><span style=color:#e6db74>}</span><span style=color:#e6db74> returned an invalide response.&#34;</span>, <span style=color:#ae81ff>6</span> );
    }
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identifier</span>    <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;id&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>firstName</span>     <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;real_name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>real_name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>displayName</span>   <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;display_name&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>display_name</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>photoURL</span>      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://upics.yandex.net/&#39;</span><span style=color:#f92672>.</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identifier</span> <span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/normal&#39;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>gender</span>        <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;sex&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>sex</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>email</span>         <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;default_email&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>default_email</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>emailVerified</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>property_exists</span>($response,<span style=color:#e6db74>&#39;default_email&#39;</span>))<span style=color:#f92672>?</span>$response<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>default_email</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;&#34;</span>;
    <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>profile</span>;
  }
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div></p><p>Изменим наш пример с Twitter на Яндекс:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$adapter <span style=color:#f92672>=</span> $hybridauth<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authenticate</span>( <span style=color:#e6db74>&#34;yandex&#34;</span> );</code></pre></div><p>Пробуем авторизоваться:</p><p><img loading=lazy src=/img/posts/hybridauth_4.png alt></p><p>И в итоге получаем:</p><p><img loading=lazy src=/img/posts/hybridauth_5.png alt></p><p>Вот и все, авторизация через Яндекс прошла успешно. Можно заняться подключением остальных сервисов, которые нам необходимы.</p><p>Удобное подключение, простое добавление новых сервисов и открытый исходный код &mdash; все то, чего не хватало при работе со сторонними сервисами. Так же, для упрощения интеграции, библиотека имеет плагины к популярным фреймворкам и CMS, таким как Yii, Symfony2, Wordpress, Drupal и <a href=https://hybridauth.github.io/hybridauth/plugins.html>другие</a>.</p><p>По поводу ошибок и неточностей, а так же с дополнениями просьба обращаться в личку.</p><p>Ссылки по теме:</p><ul><li><a href=https://hybridauth.github.io/hybridauth/>Страница библиотеки 2.x</a></li><li><a href=https://hybridauth.github.io/hybridauth/plugins.html>Страница загрузки библиотеки и плагинов 2.x</a></li><li><a href=https://github.com/hybridauth/hybridauth>Страница проекта на GitHub</a></li><li><a href=https://github.com/xbreaker/hybridauth>Мой форк проекта на GitHub</a></li><li><a href=http://oyanix.com/opensource/hybridauth/>Онлайн-демо авторизации</a></li></ul><p><strong>upd</strong>: выложил авторизацию для <a href=https://github.com/xbreaker/hybridauth/tree/master/additional-providers/hybridauth-yandex>Яндекса</a> и <a href=https://github.com/xbreaker/hybridauth/tree/master/additional-providers/hybridauth-mailru>Mail.ru</a>, <a href=https://github.com/xbreaker/hybridauth/tree/master/additional-providers/hybridauth-odnoklassniki>Одноклассники</a> получились с костылем для совместимости с PHP > 5.3.0.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://aybe.org/tags/github/>github</a></li><li><a href=https://aybe.org/tags/hybridauth/>hybridauth</a></li><li><a href=https://aybe.org/tags/social-login/>social-login</a></li><li><a href=https://aybe.org/tags/twitter/>twitter</a></li><li><a href=https://aybe.org/tags/yandex/>yandex</a></li><li><a href=https://aybe.org/tags/habr/>habr</a></li><li><a href=https://aybe.org/tags/php/>php</a></li></ul><nav class=paginav><a class=prev href=https://aybe.org/2012/08/google-plusstrap/><span class=title>« Предыдущая</span><br><span>Что если бы Google выпустил свой Bootstrap?</span></a></nav></footer><section id=comment-thread class="js-comments comment-thread"><form id=reply-form class="js-form reply-form" method=post action=https://aybeorg.herokuapp.com/v2/entry/xbreaker/xbreaker.github.io/main/comments><h3 id=reply-form-head>Добавить комментарий</h3><div id=notice class=notice></div><input type=hidden name=options[slug] value=hybriauth-integration>
<input type=hidden name=options[parent] value=https://aybe.org/2012/08/hybriauth-integration/>
<input id=input-thread type=hidden name=fields[thread]>
<input id=input-parent type=hidden name=fields[parent]>
<input id=input-parentName type=hidden name=fields[parentName]>
<input type=hidden name=options[reCaptcha][siteKey] value=6LfuipkbAAAAAFmcmiZa7HYmEk40r0JJ-ua665vQ>
<input type=hidden name=options[reCaptcha][secret] value="w0e8kjpH56nyKZkvYX0Oe4kOTSOxu3c1rr2Cw4L67iB0Gx1MTBSemXn0pY+05X3Lezu/FEORlYMB15Mr9lZHSDhdpkee2l3dw3SMD7BAkJpAErtXqyC5PsSinCsZf0989VObxa/74QAp+NyF7Zr4lbY+equDeBPN9p/TqwSv0jn5Wdj2xJOoCfdThiAEeN+6DRXIqnnIMWZ6PPVkiYuBQb8zYvywNgaJ18ctucTKlnOI3SsVR8G4R86jtkvn/+cl9u+2Tu61yS1HPwz78/Aips9OdRFcLdsConD6QqbJV4R0lKFArqjD7smPKal3z/WqH1P4gED54NuNSI6VQt+Tu0J25qgEmZuL+3tJp+Jr1WyGCjrHdvatxa/dTDQgV2F+XLSLd/RmC9GbT3ukEB1CI/IFvznuj4iHtBNog7v7mwht4CVUGzIsaHNSkzMdjP/Tbt8K7YptjkhyUISuamDwbauXiTUlQishzwP8l3iM0CJRh3gKQGBP9u5svoctjCgzQzjgHfqHDgnKD2oyzSl4l4/UmwetxCEkvmY9h05VinAqMKu+wg1TTpKh0xJ0LW7TGoctfoupnzM+XTUy0UGxHBNdVFDVoP9xoQcZgkfw2yWm96t3K78kRMqWbiNqw0ZuJPy6x1IFeuPLh9CLhwflfkJW1j8UbG+WHzQLgJJUIkQ=">
<textarea name=fields[message] placeholder="Вы можете использовать синтаксис Markdown" rows=6 required></textarea>
<input name=fields[name] type=text placeholder=имя required>
<input type=email name=fields[email] placeholder=email required><div class=g-recaptcha data-sitekey=6LfuipkbAAAAAFmcmiZa7HYmEk40r0JJ-ua665vQ></div><button id=submit>Отправить</button>
<button id=cancel-button class=d-none data-toggle=reply-form-cancel>Отменить</button></form></section></article></main><footer class=footer><span>&copy; 2021 <a href=https://aybe.org/>Ayrat Belyaev</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>